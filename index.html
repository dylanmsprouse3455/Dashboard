<script>
/* =========================
   ELEMENT BINDS
========================= */
const menu = document.getElementById("menu");
const leaveApp = document.getElementById("leaveApp");
const choreApp = document.getElementById("choreApp");

const drive = document.getElementById("drive");
const arrival = document.getElementById("arrival");
const lResult = document.getElementById("lResult");
const leaveOutput = document.getElementById("leaveOutput");

const taskTitle = document.getElementById("taskTitle");
const count = document.getElementById("count");
const choreStats = document.getElementById("choreStats");

/* =========================
   NAVIGATION
========================= */
function showLeave() {
  menu.classList.add("hidden");
  leaveApp.classList.remove("hidden");
}

function showChore() {
  menu.classList.add("hidden");
  choreApp.classList.remove("hidden");
}

function back() {
  location.reload();
}

/* =========================
   LEAVE TIME CALCULATOR
========================= */
function lNext(n) {
  document
    .querySelectorAll("#leaveApp .step")
    .forEach(s => s.classList.remove("active"));
  document.getElementById("l" + n).classList.add("active");
}

function t2m(t) {
  const [h, m] = t.split(":").map(Number);
  return h * 60 + m;
}

function m2t(mins) {
  mins = (mins + 1440) % 1440;
  let h = Math.floor(mins / 60);
  const m = mins % 60;
  const ap = h >= 12 ? "PM" : "AM";
  h = h % 12 || 12;
  return `${h}:${String(m).padStart(2, "0")} ${ap}`;
}

function calc(shower) {
  const d = Number(drive.value);
  const a = arrival.value;
  if (!a || isNaN(d)) return;

  const prep = shower ? 50 : 35;
  const arr = t2m(a);
  const leave = arr - d;
  const start = leave - prep;

  document
    .querySelectorAll("#leaveApp .step")
    .forEach(s => s.classList.remove("active"));
  lResult.classList.add("active");

  leaveOutput.innerHTML =
    `Start getting ready by: ${m2t(start)}<br>` +
    `Leave the house by: ${m2t(leave)}<br><br>` +
    `Prep time: ${prep} minutes<br>` +
    `Drive time: ${d} minutes`;
}

/* =========================
   CHORE SPEEDRUN
========================= */
const chores = [
  { name: "Cans", expected: 30 },
  { name: "Trash", expected: 30 },
  { name: "Clothes", expected: 30 },
  { name: "Shoes", expected: 30 },
  { name: "Dishes", expected: 30 },
  { name: "Dog Toys", expected: 30 }
];

let idx = -1;
let rem = 0;
let timer = null;

let taskStart = 0;
let totalExpected = 0;
let totalActual = 0;

function nextChore() {
  // Finish previous task
  if (idx >= 0) {
    clearInterval(timer);

    const actual = Math.round((Date.now() - taskStart) / 1000);
    const expected = chores[idx].expected;
    const delta = expected - actual;

    totalExpected += expected;
    totalActual += actual;

    choreStats.innerHTML =
      `Expected: ${expected}s<br>` +
      `Actual: ${actual}s<br>` +
      `<span class="${delta >= 0 ? "positive" : "negative"}">
        ${delta >= 0 ? "Saved" : "Lost"}: ${Math.abs(delta)}s
      </span>`;
  }

  idx++;

  // End of run
  if (idx >= chores.length) {
    const net = totalExpected - totalActual;

    taskTitle.textContent = "RUN COMPLETE";
    count.textContent = "";

    choreStats.innerHTML =
      `Expected total: ${totalExpected}s<br>` +
      `Actual total: ${totalActual}s<br>` +
      `<span class="${net >= 0 ? "positive" : "negative"}">
        Net ${net >= 0 ? "saved" : "lost"}: ${Math.abs(net)}s
      </span>`;
    return;
  }

  // Start next task
  const task = chores[idx];
  taskTitle.textContent = task.name;

  rem = task.expected;
  count.textContent = rem;
  taskStart = Date.now();

  timer = setInterval(() => {
    rem--;
    count.textContent = rem;
    if (rem <= 0) clearInterval(timer);
  }, 1000);
}
</script>
